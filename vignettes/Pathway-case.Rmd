---
title: "Pathway case"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Pathway-case}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(MMRcaseselection)
library(ggplot2) # for illustration of plot customization
```

The pathway case is a type of case that is supposed to make it most likely to find evidence for a mechanism. 
Originally, it was proposed by Gerring ([2007](https://doi.org/10.1177%2F0010414006290784)). The *pathway value* of a case is defined as $|resid_{reduced}-res_{full}|$ if it holds that $|resid_{reduced}| > |resid_{full}|$. In follow-up research, Weller and Barnes ([2014](https://doi.org/10.1017/CBO9781139644501)) propose a different calculation of the pathway value: $|resid_{reduced}|-|res_{full}|$. The package contains a function allowing one to calculate both pathway values and plotting them. 

The function `pathway()` requires the full regression model and the reduced regression model as input. The reduced model omits the pathway variable that is of theoretical interest. Both models must be fed into the fucntion as `lm` objects. The dataframe that is generated by the function contains all variables from the full model plus variables needed for the calculation of the pathway values:

- `full.resid`: Residuals in full model
- `reduced.resid`: Residuals in reduced model
- `pathway.wb`: Pathway values as proposed by Weller and Barnes ($|resid_{reduced}|-|res_{full}|$)
- `pathway.gvalue`: Pathway values as proposed by Gerring ($|resid_{reduced}-res_{full}|$)
- `pathway.gstatus`: Binary variable that is coded "yes" if $|resid_{reduced}| > |resid_{full}|$ is met and "no" otherwise.
```{r}
df_full <- lm(mpg ~ disp + wt, data = mtcars) # full model
df_reduced <- lm(mpg ~ wt, data = mtcars) # reduced model
pw_out <- pathway(df_full, df_reduced) # calculation of pathway values
head(pw_out)
```

The visualization of pathway values is different from the presentation of ordinary residuals because two models are involved and an observed-vs-fitted plot is not feasible. Following the approach by Weller and Barnes, the `pathway_xvr()` function allows users to the plot the pathway values against the pathway variable. The option `pathwaytype = "pathway.wb` produces a plot of the Weller/Barnes values. The option `pathway.var` specifies the pathway variable to be included in the plot. The plot is `gg` object that can be customized with the usual `ggplot2` options.
```{r, fig.height = 6, fig.width = 6}
pathway_xvr(full.model, reduced.model, 
            pathway.var = "disp", 
            pathway.type = "pathway.wb")
```

If the option is `pathway.type = "pathway.gvalue"`, the Gerring pathway values are plotted against the pathway variable. A color scheme is used to distinguish the cases that meet the pathway case requirement ("yes") from those that don't ("no").
```{r, fig.height = 6, fig.width = 6}
pathway_xvr(full.model, reduced.model, 
            pathway.var = "disp", 
            pathway.type = "pathway.gvalue")
```
